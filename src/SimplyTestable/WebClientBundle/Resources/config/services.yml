imports:
    - { resource: services/commands.yml }
    - { resource: services/resque-job-factory.yml }

services:
  SimplyTestable\WebClientBundle\Services\TestService:
    class:   SimplyTestable\WebClientBundle\Services\TestService
    arguments:
        entityManager: '@doctrine.orm.entity_manager'
        logger: '@logger'
        taskService: '@SimplyTestable\WebClientBundle\Services\TaskService'
        remoteTestService: '@SimplyTestable\WebClientBundle\Services\RemoteTestService'

  SimplyTestable\WebClientBundle\Services\RemoteTestService:
    class:   SimplyTestable\WebClientBundle\Services\RemoteTestService
    arguments:
        coreApplicationHttpClient: '@SimplyTestable\WebClientBundle\Services\CoreApplicationHttpClient'
        jsonResponseHandler: '@SimplyTestable\WebClientBundle\Services\JsonResponseHandler'

  SimplyTestable\WebClientBundle\Services\TaskService:
    class:   SimplyTestable\WebClientBundle\Services\TaskService
    arguments:
        entityManager: '@doctrine.orm.entity_manager'
        taskOutputResultParserService: '@SimplyTestable\WebClientBundle\Services\TaskOutput\ResultParser\Factory'
        coreApplicationHttpClient: '@SimplyTestable\WebClientBundle\Services\CoreApplicationHttpClient'
        jsonResponseHandler: '@SimplyTestable\WebClientBundle\Services\JsonResponseHandler'
        taskFactory: '@SimplyTestable\WebClientBundle\Services\Factory\TaskFactory'
        taskOutputFactory: '@SimplyTestable\WebClientBundle\Services\Factory\TaskOutputFactory'

  SimplyTestable\WebClientBundle\Services\TaskCollectionFilterService:
    class:   SimplyTestable\WebClientBundle\Services\TaskCollectionFilterService
    arguments:
        entityManager: '@doctrine.orm.entity_manager'

  SimplyTestable\WebClientBundle\Services\CacheValidatorHeadersService:
    class:   SimplyTestable\WebClientBundle\Services\CacheValidatorHeadersService
    arguments:
        entityManager: '@doctrine.orm.entity_manager'

  SimplyTestable\WebClientBundle\Services\Resque\QueueService:
    class:   SimplyTestable\WebClientBundle\Services\Resque\QueueService
    arguments:
      resque: '@resque'
      logger: '@logger'
      jobFactoryService: '@webignition\ResqueJobFactory\ResqueJobFactory'
      environment: '%kernel.environment%'

  SimplyTestable\WebClientBundle\Services\UserService:
    class:  SimplyTestable\WebClientBundle\Services\UserService
    arguments:
        coreApplicationHttpClient: '@SimplyTestable\WebClientBundle\Services\CoreApplicationHttpClient'
        jsonResponseHandler: '@SimplyTestable\WebClientBundle\Services\JsonResponseHandler'

  SimplyTestable\WebClientBundle\Services\UserEmailChangeRequestService:
    class:  SimplyTestable\WebClientBundle\Services\UserEmailChangeRequestService
    arguments:
        coreApplicationHttpClient: '@SimplyTestable\WebClientBundle\Services\CoreApplicationHttpClient'
        jsonResponseHandler: '@SimplyTestable\WebClientBundle\Services\JsonResponseHandler'

  SimplyTestable\WebClientBundle\Services\UserSerializerService:
    class:  SimplyTestable\WebClientBundle\Services\UserSerializerService
    arguments:
        key: '%secret%'

  SimplyTestable\WebClientBundle\Services\TestOptions\Adapter\Request\FeatureParser\OptionsParser:
    class:  SimplyTestable\WebClientBundle\Services\TestOptions\Adapter\Request\FeatureParser\OptionsParser

  SimplyTestable\WebClientBundle\Services\TestOptions\Adapter\Request\FeatureParser\CookieOptionsParser:
    class:  SimplyTestable\WebClientBundle\Services\TestOptions\Adapter\Request\FeatureParser\CookieOptionsParser

  SimplyTestable\WebClientBundle\Services\TestOptions\Adapter\Request\Adapter:
    class:  SimplyTestable\WebClientBundle\Services\TestOptions\Adapter\Request\Adapter
    calls:
      - [addFeatureOptionsParser, ['@SimplyTestable\WebClientBundle\Services\TestOptions\Adapter\Request\FeatureParser\OptionsParser']]
      - [addFeatureOptionsParser, ['@SimplyTestable\WebClientBundle\Services\TestOptions\Adapter\Request\FeatureParser\CookieOptionsParser', 'cookies']]

  SimplyTestable\WebClientBundle\Services\UserPlanSubscriptionService:
    class:  SimplyTestable\WebClientBundle\Services\UserPlanSubscriptionService
    arguments:
        stripeErrorFactory: '@SimplyTestable\WebClientBundle\Services\StripeErrorFactory'
        coreApplicationHttpClient: '@SimplyTestable\WebClientBundle\Services\CoreApplicationHttpClient'

  SimplyTestable\WebClientBundle\Services\UserAccountCardService:
    class:  SimplyTestable\WebClientBundle\Services\UserAccountCardService
    arguments:
        stripeErrorFactory: '@SimplyTestable\WebClientBundle\Services\StripeErrorFactory'
        coreApplicationRouter: '@SimplyTestable\WebClientBundle\Services\CoreApplicationRouter'
        coreApplicationHttpClient: '@SimplyTestable\WebClientBundle\Services\CoreApplicationHttpClient'

  SimplyTestable\WebClientBundle\Services\UserStripeEventService:
    class:  SimplyTestable\WebClientBundle\Services\UserStripeEventService
    arguments:
        coreApplicationHttpClient: '@SimplyTestable\WebClientBundle\Services\CoreApplicationHttpClient'
        jsonResponseHandler: '@SimplyTestable\WebClientBundle\Services\JsonResponseHandler'

  SimplyTestable\WebClientBundle\Services\DocumentationUrlCheckerService:
    class:  SimplyTestable\WebClientBundle\Services\DocumentationUrlCheckerService

  SimplyTestable\WebClientBundle\Services\MailChimp\Service:
    class:   SimplyTestable\WebClientBundle\Services\MailChimp\Service
    arguments:
        mailChimpClient: '@SimplyTestable\WebClientBundle\Services\MailChimp\Client'
        listRecipientsService: '@SimplyTestable\WebClientBundle\Services\MailChimp\ListRecipientsService'

  SimplyTestable\WebClientBundle\Services\Mail\Configuration:
    class:   SimplyTestable\WebClientBundle\Services\Mail\Configuration
    arguments:
        configuration: '%mail%'

  SimplyTestable\WebClientBundle\Services\Postmark\Sender:
    class:   SimplyTestable\WebClientBundle\Services\Postmark\Sender

  SimplyTestable\WebClientBundle\Services\Mail\Service:
    class:   SimplyTestable\WebClientBundle\Services\Mail\Service
    arguments:
        mailConfiguration: '@SimplyTestable\WebClientBundle\Services\Mail\Configuration'
        postmarkMessage: '@postmark.message'
        postmarkSender: '@SimplyTestable\WebClientBundle\Services\Postmark\Sender'

  SimplyTestable\WebClientBundle\EventListener\Stripe\Listener:
    class:   SimplyTestable\WebClientBundle\EventListener\Stripe\Listener
    arguments:
        logger: '@logger'
        templating: '@templating'
        router: '@router'
        mailService: '@SimplyTestable\WebClientBundle\Services\Mail\Service'
    tags:
      - { name: kernel.event_listener, event: stripe.customer.subscription.created, method: onCustomerSubscriptionCreated }
      - { name: kernel.event_listener, event: stripe.customer.subscription.deleted, method: onCustomerSubscriptionDeleted }
      - { name: kernel.event_listener, event: stripe.customer.subscription.trial_will_end, method: onCustomerSubscriptionTrialWillEnd }
      - { name: kernel.event_listener, event: stripe.customer.subscription.updated, method: onCustomerSubscriptionUpdated }
      - { name: kernel.event_listener, event: stripe.invoice.payment_succeeded, method: onInvoicePaymentSucceeded }
      - { name: kernel.event_listener, event: stripe.invoice.payment_failed, method: onInvoicePaymentFailed }

  SimplyTestable\WebClientBundle\EventListener\RequestListener:
    class: SimplyTestable\WebClientBundle\EventListener\RequestListener
    arguments:
        kernel: '@kernel'
    tags:
      - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest }

  SimplyTestable\WebClientBundle\EventListener\MailChimp\Listener:
    class:   SimplyTestable\WebClientBundle\EventListener\MailChimp\Listener
    arguments:
        mailchimpListRecipientsService: '@SimplyTestable\WebClientBundle\Services\MailChimp\ListRecipientsService'
        entityManager: '@doctrine.orm.entity_manager'
    tags:
      - { name: kernel.event_listener, event: mailchimp.subscribe, method: onSubscribe }
      - { name: kernel.event_listener, event: mailchimp.unsubscribe, method: onUnsubscribe }
      - { name: kernel.event_listener, event: mailchimp.upemail, method: onUpEmail }
      - { name: kernel.event_listener, event: mailchimp.cleaned, method: onCleaned }

  SimplyTestable\WebClientBundle\Services\MailChimp\ListRecipientsService:
    class:   SimplyTestable\WebClientBundle\Services\MailChimp\ListRecipientsService
    arguments:
        entityManager: '@doctrine.orm.entity_manager'
        logger: '@logger'
        listIdentifiers:
          announcements: '%mailchimp_announcements_list_id%'
          updates: '%mailchimp_updates_list_id%'
          introduction: '%mailchimp_introduction_list_id%'

  SimplyTestable\WebClientBundle\Services\TaskTypeService:
    class:  SimplyTestable\WebClientBundle\Services\TaskTypeService
    calls:
      - [setTaskTypes, ['%task_types%']]
      - [setEarlyAccessUsers, ['%early_access_users%']]

  SimplyTestable\WebClientBundle\Services\TeamService:
    class:   SimplyTestable\WebClientBundle\Services\TeamService
    arguments:
        coreApplicationHttpClient: '@SimplyTestable\WebClientBundle\Services\CoreApplicationHttpClient'
        jsonResponseHandler: '@SimplyTestable\WebClientBundle\Services\JsonResponseHandler'

  SimplyTestable\WebClientBundle\Services\TeamInviteService:
    class:   SimplyTestable\WebClientBundle\Services\TeamInviteService
    arguments:
        coreApplicationHttpClient: '@SimplyTestable\WebClientBundle\Services\CoreApplicationHttpClient'
        jsonResponseHandler: '@SimplyTestable\WebClientBundle\Services\JsonResponseHandler'

  SimplyTestable\WebClientBundle\Services\CouponService:
    class:  SimplyTestable\WebClientBundle\Services\CouponService
    calls:
      - [setCouponData, ['%coupons%']]

  SimplyTestable\WebClientBundle\Services\PlansService:
    class:  SimplyTestable\WebClientBundle\Services\PlansService
    calls:
      - [setPlansData, ['%plans%']]

  SimplyTestable\WebClientBundle\Services\StripeErrorFactory:
    class: SimplyTestable\WebClientBundle\Services\StripeErrorFactory

  SimplyTestable\WebClientBundle\Services\TestOptions\Adapter\Factory:
    class: SimplyTestable\WebClientBundle\Services\TestOptions\Adapter\Factory
    arguments:
      adapter: '@SimplyTestable\WebClientBundle\Services\TestOptions\Adapter\Request\Adapter'
      taskTypeService: '@SimplyTestable\WebClientBundle\Services\TaskTypeService'
      parameters: '%test_options%'

  SimplyTestable\WebClientBundle\Services\UrlViewValuesService:
    class: SimplyTestable\WebClientBundle\Services\UrlViewValuesService

  SimplyTestable\WebClientBundle\Services\CacheValidatorService:
    class: SimplyTestable\WebClientBundle\Services\CacheValidatorService
    arguments:
      cacheValidatorHeadersService: '@SimplyTestable\WebClientBundle\Services\CacheValidatorHeadersService'
      userManager: '@SimplyTestable\WebClientBundle\Services\UserManager'

  simplytestable.services.flashbagvalues:
    class: SimplyTestable\WebClientBundle\Services\FlashBagValues
    arguments:
      session: '@session'

  SimplyTestable\WebClientBundle\Services\TaskOutput\ResultParser\HtmlValidationResultParser:
    class: SimplyTestable\WebClientBundle\Services\TaskOutput\ResultParser\HtmlValidationResultParser

  SimplyTestable\WebClientBundle\Services\TaskOutput\ResultParser\CssValidationResultParser:
    class: SimplyTestable\WebClientBundle\Services\TaskOutput\ResultParser\CssValidationResultParser

  SimplyTestable\WebClientBundle\Services\TaskOutput\ResultParser\JsStaticAnalysisResultParser:
    class: SimplyTestable\WebClientBundle\Services\TaskOutput\ResultParser\JsStaticAnalysisResultParser

  SimplyTestable\WebClientBundle\Services\TaskOutput\ResultParser\LinkIntegrityResultParser:
    class: SimplyTestable\WebClientBundle\Services\TaskOutput\ResultParser\LinkIntegrityResultParser

  SimplyTestable\WebClientBundle\Services\TaskOutput\ResultParser\Factory:
    class:   SimplyTestable\WebClientBundle\Services\TaskOutput\ResultParser\Factory
    calls:
      - [addResultParser, ['@SimplyTestable\WebClientBundle\Services\TaskOutput\ResultParser\HtmlValidationResultParser']]
      - [addResultParser, ['@SimplyTestable\WebClientBundle\Services\TaskOutput\ResultParser\CssValidationResultParser']]
      - [addResultParser, ['@SimplyTestable\WebClientBundle\Services\TaskOutput\ResultParser\JsStaticAnalysisResultParser']]
      - [addResultParser, ['@SimplyTestable\WebClientBundle\Services\TaskOutput\ResultParser\LinkIntegrityResultParser']]

  SimplyTestable\WebClientBundle\Services\ResourceLocator:
    class: SimplyTestable\WebClientBundle\Services\ResourceLocator
    arguments:
      - '@kernel'

  SimplyTestable\WebClientBundle\Services\ApplicationConfigurationService:
    class: SimplyTestable\WebClientBundle\Services\ApplicationConfigurationService
    arguments:
      - '@=service("kernel").getRootDir()'
      - '@=service("kernel").getCacheDir()'

  SimplyTestable\WebClientBundle\Services\CoreApplicationRouter:
    class: SimplyTestable\WebClientBundle\Services\CoreApplicationRouter
    arguments:
      - '%core_url%'
      - '@SimplyTestable\WebClientBundle\Services\ResourceLocator'
      - '@SimplyTestable\WebClientBundle\Services\ApplicationConfigurationService'

  SimplyTestable\WebClientBundle\Services\CoreApplicationResponseCache:
    class: SimplyTestable\WebClientBundle\Services\CoreApplicationResponseCache

  SimplyTestable\WebClientBundle\Services\CoreApplicationHttpClient:
    class: SimplyTestable\WebClientBundle\Services\CoreApplicationHttpClient
    arguments:
      - '@SimplyTestable\WebClientBundle\Services\CoreApplicationRouter'
      - '@SimplyTestable\WebClientBundle\Services\CoreApplicationResponseCache'
      - '@SimplyTestable\WebClientBundle\Services\SystemUserService'

  SimplyTestable\WebClientBundle\Services\JsonResponseHandler:
    class: SimplyTestable\WebClientBundle\Services\JsonResponseHandler

  SimplyTestable\WebClientBundle\Services\SystemUserService:
    class:  SimplyTestable\WebClientBundle\Services\SystemUserService
    arguments:
      - '%admin_user_username%'
      - '%admin_user_password%'

  SimplyTestable\WebClientBundle\Services\UserManager:
    class:  SimplyTestable\WebClientBundle\Services\UserManager
    arguments:
      - '@request_stack'
      - '@SimplyTestable\WebClientBundle\Services\UserSerializerService'
      - '@session'
      - '@SimplyTestable\WebClientBundle\Services\SystemUserService'

  SimplyTestable\WebClientBundle\Services\MailChimp\Client:
    class:  SimplyTestable\WebClientBundle\Services\MailChimp\Client
    arguments:
      - '%mailchimp_api_key%'

  SimplyTestable\WebClientBundle\Services\Factory\TaskOutputFactory:
    class:  SimplyTestable\WebClientBundle\Services\Factory\TaskOutputFactory
    arguments:
      - '@doctrine.orm.entity_manager'

  SimplyTestable\WebClientBundle\Services\Factory\TaskFactory:
    class:  SimplyTestable\WebClientBundle\Services\Factory\TaskFactory
    arguments:
      - '@SimplyTestable\WebClientBundle\Services\Factory\TaskOutputFactory'
